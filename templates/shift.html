<!DOCTYPE html>
<html lang="en">


<head>

    <!-- Meta Tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shift Management</title>
	
	<meta name="description" content="Shift Management">
	<meta name="keywords" content="Shift Management">
	<meta name="author" content="Devansh Bullion">
    <meta name="robots" content="index, follow">

    {% include 'css.html' %}

</head>

<body> 

    <!-- Main Wrapper -->
    <div class="main-wrapper">

        <!-- Header -->
        {% include 'header.html' %}
        <!-- /Header -->

        <!-- Sidebar -->
        {% include 'sidebar.html' %}


        <!-- Page Wrapper -->
        <div class="page-wrapper" style="min-height: 570px;">
            <div class="content">

                <!-- Breadcrumb -->
                <div class="d-md-flex d-block align-items-center justify-content-between page-breadcrumb mb-3">
                    <div class="my-auto mb-2">
                        <h2 class="mb-1">Schedule Shifts</h2> 
                    </div>
                   
                </div>
                <!-- /Breadcrumb -->

                <div class="card">
                    <div class="card-header d-flex align-items-center justify-content-between flex-wrap row-gap-3">
                        <h5>Schedule Shift List</h5>
             
                    </div>
                    <div class="card-body p-0">
                        <div class="custom-datatable-filter table-responsive">
                            <div id="DataTables_Table_0_wrapper" class="dataTables_wrapper dt-bootstrap5 no-footer">
                                <div class="row">
                                   
                                </div>
                                <div class="row dt-row">
                                    <div class="col-sm-12 table-responsive">
                                        <table class="table datatable dataTable no-footer" id="DataTables_Table_0"
                                            aria-describedby="DataTables_Table_0_info">
                                            <thead class="thead-light">
                                                <tr>
                                                  
                                                    <th class="sorting" tabindex="0" aria-controls="DataTables_Table_0"
                                                        rowspan="1" colspan="1"
                                                        aria-label="Name: activate to sort column ascending"
                                                        style="width: 222.078125px;">Name</th>
                                                    <th class="sorting" tabindex="0" aria-controls="DataTables_Table_0"
                                                        rowspan="1" colspan="1"
                                                        aria-label="Job Title: activate to sort column ascending"
                                                        style="width: 124.515625px;">Employee Id</th>
                                                    <th class="sorting" tabindex="0" aria-controls="DataTables_Table_0"
                                                        rowspan="1" colspan="1"
                                                        aria-label="User Available Timings: activate to sort column ascending"
                                                        style="width: 320.34375px;">Shift</th>
                                                    <th class="sorting" tabindex="0" aria-controls="DataTables_Table_0"
                                                        rowspan="1" colspan="1"
                                                        aria-label=": activate to sort column ascending"
                                                        style="width: 216.296875px;"></th>
                                                </tr>
                                            </thead>
                                            <tbody>

{% for i in allemp %}

                                                <tr >
                                                 
                                                    <td>
                                                        <div class="d-flex align-items-center file-name-icon">
                                                            <a href="#" class="avatar avatar-md border avatar-rounded">
                                                                <img src="/media/{{i.employee.profile}}"
                                                                    class="img-fluid" alt="img">
                                                            </a>
                                                            <div class="ms-2">
                                                                <h6 class="fw-medium"><a href="#">{{i.employee.name}}</a></h6>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td>Emp-{{ i.employee.id|stringformat:"03d" }}</td>
                                                    <td>
                                           {{ i.shift.name|default:"-" }}

                                                    </td>
                                                    <td>
                                                        <div>
                                                          <a href="#" data-bs-toggle="modal"
   data-bs-target="#schedule_timing"
   data-emp-id="{{ i.employee.id }}"
   data-emp-name="{{ i.employee.name }}"
   class="btn btn-dark schedule-btn">Schedule Timing</a>

                                                        </div>
                                                    </td>
                                                </tr>

                                                {% endfor %}
                                               
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                             
                            </div>
                        </div>
                    </div>
                </div>

<div id="schedule_timing" class="modal custom-modal fade" role="dialog">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Schedule</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="schedule-form" method="post">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-sm-12 mb-3">
                            <input type="hidden" name="employee_id" id="schedule-employee-id">

                         
                          <div class="input-block mb-3">
    <label class="col-form-label">Employee</label>
    <input type="text" class="form-control" id="schedule-employee-name" readonly>
</div>

                        </div>
                        <div class="col-sm-12 mb-3">
                            <label class="col-form-label">Shift <span class="text-danger">*</span></label>
                            <select name="shift_id" class="form-control" required>
                                <option value="">Select</option>
                                {% for shift in allshift %}
                                <option value="{{ shift.id }}">{{ shift.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                     
                    </div>
                    <div class="submit-section">
                        <button type="submit" class="btn btn-primary submit-btn">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

            </div>

            <div class="footer d-sm-flex align-items-center justify-content-between border-top bg-white p-3">
                <p class="mb-0">2025 © Webx Hubs.</p>
                <p>Designed &amp; Developed By <a href="javascript:void(0);" class="text-primary">Webx Hubs</a></p>
            </div>

        </div>
        <!-- /Page Wrapper -->

 
        <script>
            $('#schedule_timing form').on('submit', function (e) {
    e.preventDefault();

    const formData = {
        employee_id: $('#schedule-employee-id').val(),
        shift_id: $('#schedule_timing select').val(),
        csrfmiddlewaretoken: '{{ csrf_token }}',
    };

    $.ajax({
        url: '{% url "add_schedule" %}', // Your Django view URL name
        type: 'POST',
        data: formData,
        success: function (response) {
            if (response.success) {
                alert('Schedule saved successfully!');
                $('#schedule_timing').modal('hide');
                location.reload(); // or update DOM
            } else {
                alert('Error: ' + response.message);
            }
        },
        error: function () {
            alert('Something went wrong!');
        }
    });
});

 
</script>

<script>
    $(document).on('click', '.schedule-btn', function () {
        const empId = $(this).data('emp-id');
        const empName = $(this).data('emp-name');

        $('#schedule-employee-id').val(empId);
        $('#schedule-employee-name').val(empName);
    });
</script>


    </div>
    <!-- /Main Wrapper -->
    {% include 'js.html' %}
</body>


</html>